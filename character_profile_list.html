<!DOCTYPE html>
<html lang="en">
<head>

    <!--————————————————————————————————————————————————————————-->
    <!--——————————————————[ PAGE-INFORMATION ]——————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <title>OpenProfile 5 Preview</title>
    <link rel="icon" href="/media/icons/openprofile_logo.svg" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">

    <!-- Dynamic domain -->
    <base href="">

    <!--————————————————————————————————————————————————————————-->
    <!--—————————————————————[ META-TAGS ]——————————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="OpenProfile 5" />
    <meta property="twitter:creator" content="@OpenProfileApp" />
    <meta property="og:description" content="Author hasn't set a bio." />
    <meta property="og:image" content="https://raw.githubusercontent.com/OpenProfileApp/OP5-Preview/web/media/images/openprofile/openprofile_logo_512_jpeg.jpeg" />
    <meta property="og:url" content="https://preview.openprofile.app" />
    <meta property="theme-color" content="#e5b432" />

    <!--————————————————————————————————————————————————————————-->
    <!--————————————————————[ STYLESHEETS ]—————————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <link rel="stylesheet" type="text/css" href="/author_profile_desktop.css">
    <!--<link rel="stylesheet" type="text/css" href="mobile_styles.css">-->
    <!--<link rel="stylesheet" type="text/css" media="print" href="print_styles.css">-->
</head>
<body>

    <!--————————————————————————————————————————————————————————-->
    <!--————————————————————[ BASE-SCRIPTS ]————————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <script src="/scripts/clear_cache.js" type="text/javascript"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="/scripts/google_api.js"></script>
    <script src="/scripts/account/login.js"></script>
    <script src="/scripts/countrycodes.js"></script>
    <!--<script src="/scripts/discord/activity/activity_main.js"></script>-->
    <script src="/scripts/discord/assistant/events/view_profile.js"></script>
    <script src="/scripts/scheme_manager_profile.js"></script>
    <script src="/scripts/seasonal_changes.js"></script>
    <script src="/scripts/banner.js"></script>
    <script src="/scripts/onload_page.js"></script>
    <script src="/scripts/account/session_load.js"></script>
    <script src="/scripts/delete_profile_server.js"></script>
    <script src="/scripts/edit_profile_server.js"></script>
    
    <!--————————————————————————————————————————————————————————-->
    <!--——————————————————[ POP-UP-ELEMENTS ]———————————————————-->
    <!--————————————————————————————————————————————————————————-->

    <div id="login_register_account_manager">
        <div class="information_text" id="registrationMessage" style="top: 59%; font-size: 9px; z-index: 4999; display: none;"></div>
    </div>

    <!--————————————————————————————————————————————————————————-->
    <!--——————————————————[ BANNER-ELEMENTS ]———————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <div class="banner" id="banner_0">
        <div class="banner_text" id="banner_0_text">Introducing a brand new ui alongside a bunch of backend bug fixes! New ones too...</div>
        <div class="banner_close" id="banner_0_close">
            <img src="/media/icons/feather_icons/x.svg" style="position: relative; top: 24px; right: 24px; scale: 1; transform-origin: top left; z-index: 3000;">
        </div>
    </div>

    <!--————————————————————————————————————————————————————————-->
    <!--————————————————————[ TOP-ELEMENTS ]————————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <div class="top">
        <img id="openprofile_title_logo" src="/media/icons/openprofile_logo.svg" style="position: absolute; height: 36px; margin: 6px;">
        <p id="openprofile_title_text" style="position: absolute; color: #ffffff; opacity: 1; font-family: NotoSans-Bold; left: 48px; top: -16px; font-size: 18px;">OpenProfile 5</p>
        <p id="openprofile_version_text" style="position: absolute; color: #ffffff; opacity: 1; font-family: NotoSans-Medium; left: 48px; top: 14px; font-size: 12px;">Version failed to load...</p>

        <a class="top_button" id="premium_button" href="https://ko-fi.com/openprofile" target="_blank" style="background: #cfa715; border-radius: 25px; text-indent: 32px; margin-left: 192px; color: #ffffff;;">Go Premium
            <img src="/media/icons/openprofile_logo.svg" style="position: absolute; left: 0px; height: 28px; transform-origin: top left; margin: 2px;">
        </a>
        <a class="top_button" id="app_button" href="https://openprofile.app" style="background: #ce1616; border-radius: 25px; text-indent: 32px; margin-left: 0px; color: #ffffff">Launch OpenProfile
            <img src="/media/icons/openprofile_logo.svg" style="position: absolute; left: 0px; height: 28px; transform-origin: top left; margin: 2px;">
        </a>
        <a class="top_button" id="app_button" href="https://preview.openprofile.app/authors" style="background: #ce1616; border-radius: 25px; text-indent: 8px; margin-left: 0px; color: #ffffff">Authors</a>

        <div class="control_button" id="login_register_account">
            <img class="icon" id="icon_account" src="/media/icons/feather_icons/user.svg" style="scale: 0.24; transform-origin: top left; margin: 4px; opacity: 0.8;">
            <div class="label_top" id="label_top_account">Account</div>
            <script src="/scripts/account/login.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
        </div>
        <div class="control_button" id="button_scheme">
            <img class="icon" id="icon_scheme" src="/media/icons/feather_icons/droplet.svg" style="scale: 0.24; transform-origin: top left; margin: 4px;">
            <div class="notification_dot"></div>
            <div class="label_top">Schemes</div>
        </div>
        <div class="control_button" style="width: min-content; border-radius: 100px;">
            <img class="icon" src="/media/icons/feather_icons/mail.svg" style="position: absolute; scale: 0.24; transform-origin: top left; margin-top: 4px; margin-left: 5px;">
            <div class="notification_count" id="mail_count">0</div>
            <div class="notification_dot"></div>
            <div class="label_top">Messages</div>
        </div>
        <div class="control_button" style="width: min-content; border-radius: 100px;">
            <img class="icon" src="/media/icons/feather_icons/bell.svg" style="position: absolute; scale: 0.24; transform-origin: top left; margin: 4px;">
            <div class="notification_count" id="notif_count" style="transform: translateX(-2px);">0</div>
            <div class="notification_dot"></div>
            <div class="label_top">Notifications</div>
        </div>
        <div class="control_button" style="width: min-content; border-radius: 100px;">
            <img class="icon" src="/media/icons/feather_icons/inbox.svg" style="position: absolute; scale: 0.22; transform-origin: top left; margin: 5px;">
            <div class="notification_count" id="notif_count" style="transform: translateX(-2px);">0</div>
            <div class="notification_dot"></div>
            <div class="label_top">Tickets</div>
        </div>
        <div class="control_button" style="width: min-content; border-radius: 100px;">
            <img class="icon" src="/media/icons/feather_icons/flag.svg" style="position: absolute; scale: 0.22; transform-origin: top left; margin: 5px;">
            <div class="notification_count" id="notif_count" style="transform: translateX(-2px);">0</div>
            <div class="notification_dot"></div>
        <div class="label_top">Reports</div>
        </div>
        <div class="control_button" id="user_check_hello">
            <img class="icon" id="icon_wave" src="/media/icons/media_icons/discord.svg" style="width: 20px; transform-origin: top left; margin-top: 8px; margin-left: 6px; opacity: 0.8;">
            <div class="label_top">Wave</div>
            <script src="/scripts/wave.js"></script>
            <script src="/scripts/discord/assistant/commands/check.js"></script>
        </div>

        <!--————————————————————————————————————————————————————————-->
        <!--——————————————————[ SCHEMES-MANAGER ]———————————————————-->
        <!--————————————————————————————————————————————————————————-->
        <!-- The scheme manager (class="schemes_manager") and the
        scheme layer (class="schemes_layer") HTML is managed by the
        scheme manager script which can be found under the following
        path (src="/scripts/scheme_manager_profile.js") -->
        <div class="schemes_manager" style="right: 6px;"></div>
        <div class="schemes_layer"></div>
    </div>
    
    <!--————————————————————————————————————————————————————————-->
    <!--——————————————————[ PROFILE-ELEMENTS ]——————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <div class="author_list" id="authors_info"></div>
    <script>
        var ownerloggedin = null;
        var ownerloggedinName = null;
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                const response = await fetch('/check-login');
                const data = await response.json();

                if (data.loggedIn) {
                    const userData = data.userData;
                    ownerloggedin = userData.id;
                    ownerloggedinName = userData.username;
                }
            } catch (error) {
                console.error('Error:', error);
            }

            fetch(`/profiles-fetch`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch authors');
                }
                return response.json();
            })
            .then(authors => {
                // Convert updatedFDate and updatedFTime to Date objects and combine them into a single property for sorting
                authors.forEach(author => {
                    const joinDateTime = new Date(`${author.updatedDate} ${author.updatedTime}`);
                    author.joinDateTime = joinDateTime;
                });

                authors.sort((a, b) => {
                    // If one author is promoted and the other isn't, prioritize the promoted one to appear first
                    if (a.promoted && !b.promoted) {
                        return -1;
                    } else if (!a.promoted && b.promoted) {
                        return 1;
                    }
                    
                    // If both authors are promoted or both are not promoted, then check verification status
                    if (a.promoted === b.promoted) {
                        // If one author is verified and the other isn't, prioritize the verified one to appear first
                        if (a.verified && !b.verified) {
                            return -1;
                        } else if (!a.verified && b.verified) {
                            return 1;
                        }
                        
                        // If both authors are verified or both are not verified, sort by join date and time
                        return b.joinDateTime - a.joinDateTime;
                    }
                    
                    // If both authors are promoted or both are not promoted, sort by join date and time
                    return b.joinDateTime - a.joinDateTime;
                });
        
                const authorsInfo = document.getElementById('authors_info');
                
                authors.forEach(author => {

                    let adminauthor = (author.owner === ownerloggedin);
                    let moderator = (ownerloggedinName == "admin") || (ownerloggedinName == "avatarkage");

                    const joinDate = new Date(`${author.updatedDate} ${author.updatedTime}`);
                    const fullVisualDate = joinDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        
                    const authorDiv = document.createElement('div');
                    authorDiv.classList.add('author_card');

                    const badges = [];
                    if (author.verified) badges.push({ src: '/media/icons/feather_icons/check.svg', backgroundColor: '#cf1516', scale: '0.8' });
                    if (author.promoted) badges.push({ src: '/media/icons/feather_icons/arrow-up.svg', backgroundColor: '#cfa715', scale: '0.8' });

                    // Conditionally add border style if author is promoted
                    const borderStyle = author.promoted ? '2px solid #cfa715' : '';
                    authorDiv.style.border = borderStyle;

                    const badgesHTML = badges.map(badge => `
                        <img class="badge-icon" src="${badge.src}" style="width: 28px; height: 28px; padding: 8px; border-radius: 50%; background-color: ${badge.backgroundColor}; margin-top: 10px; margin-left: 4px; transform: scale(${badge.scale});">
                    `).join('');

                    const admin = [];
                    if (adminauthor) admin.push({ src: '/media/icons/feather_icons/edit-3.svg', scale: '0.8', id: `editprofile_${author.id}`  });
                    if (adminauthor || moderator) admin.push({ src: '/media/icons/feather_icons/trash-2.svg', scale: '0.8', id: `deleteprofile_${author.id}` });

                    const profileADMIN = admin.map(admin => `
                        <img class="admin-icon" id="${admin.id}" src="${admin.src}" style="width: 28px; height: 28px; padding: 8px; border-radius: 50%; margin-top: 10px; margin-left: 4px; transform: scale(${admin.scale}); cursor: pointer;">
                    `).join('');
        
                    authorDiv.innerHTML = `
                    <div style="width: 200px; overflow: hidden;">
                        <img src="${author.pfp_1}" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 48px; margin-top: 8px; cursor: pointer; object-fit: cover; display: block; margin-left: auto; margin-right: auto;" onclick="window.location.href='https://preview.openprofile.app/profile/${author.url}'">                        
                        <p style="font-size: 32px; font-family: NotoSans-Bold; transform: translateY(-50px); cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" onclick="window.location.href='https://preview.openprofile.app/profile/${author.url}'">${author.page_display_name_1 ? author.page_display_name_1 : author.url}</p><br>
                        <p style="font-size: 9px; font-family: NotoSans-Medium; transform: translateY(-110px); cursor: pointer;" onclick="window.location.href='https://preview.openprofile.app/profile/${author.url}'">openprofile.app/profile/${author.url}</p>
                        <div style="display: inline-flex; align-items: center; justify-items: center; transform: translate(-2px, -128px); overflow-x: auto;">
                            ${badgesHTML}
                            ${profileADMIN}
                        </div>
                        <p style="font-size: 16px; font-family: NotoSans-Medium; transform: translateY(-145px); cursor: pointer;" onclick="window.location.href='https://preview.openprofile.app/author/${author.owner2}'">By @${author.owner2}</p>
                        <p style="position: absolute; font-size: 16px; font-family: NotoSans-Medium; bottom: -4px; left: 50%; transform: translateX(-50%); width: 200px; text-align: center;">Updated on ${fullVisualDate}</p>
                    </div>
                `;
        
                    authorsInfo.appendChild(authorDiv);
                });
                
                // Add CSS grid layout
                const authorProfiles = document.querySelectorAll('.author_profile');
                authorProfiles.forEach((authorProfile, index) => {
                    authorProfile.style.gridRow = Math.floor(index / 5) + 1;
                    authorProfile.style.gridColumn = (index % 5) + 1;
                });
            });
        })
        .catch(error => console.error('Error fetching authors:', error));
    </script>
    


    <!--————————————————————————————————————————————————————————-->
    <!--—————————————————[ DEVELOPER-ELEMENTS ]—————————————————-->
    <!--————————————————————————————————————————————————————————-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script src="/scripts/id_generator.js"></script>
    <script src="/scripts/translate.js"></script>


<!--<button style="z-index: 500; position: absolute; top: 0; left: 0;" id="discord">Send Message to Discord</button>
<script>
    const discordButton = document.getElementById('discord');

    discordButton.addEventListener('click', () => {
        // Send a POST request to your server to trigger sending the message to Discord
        fetch('/send-message-to-discord', {
            method: 'POST',
        })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            })
            .catch(error => {
                console.error(error);
            });
    });
</script>-->

<!--<script>
    // Create a WebSocket connection to the server
const socket = new WebSocket('ws://localhost:3000');

// Listen for WebSocket messages
socket.addEventListener('message', (event) => {
    const newText = event.data;
    
    // Update the page_author_0 textbox with the received text
    document.getElementById('page_author_0').value = newText;
});


<li id="theme_option" style="opacity: 0.35;">🎨 Change Scheme ></li>
        <div id="themeSubMenu" class="menu" style="scale: 100%;">
            <script src="/scripts/menus/theme_menu.js"></script>
            <ul>
            <li id="release" style="opacity: 0.35;">🔴 Release</li>
            <li id="beta" style="opacity: 0.35;">🔵 Beta</li>
            <li id="preview" style="opacity: 0.35;">🟣 Preview</li>
            <li>
                <label for="fileInput" id="labelCustomStyles" style="opacity: 0.35;">⚪ Import Custom</label>
                <input type="file" id="customStyleInput" name="fileInput" style="display: none;">
            </li>
            </ul>
            <script src="/scripts/theme_changer.js"></script>
        </div>-->

</script>

    <div class="history_popup">
        <!-- History content will be added here -->
    </div>



    <script>
        // Check if the user is already logged in
const loggedInUser = localStorage.getItem('loggedInUser') || sessionStorage.getItem('loggedInUser');

// Reference to the logout button
const logoutButton = document.getElementById('logoutButton');

if (loggedInUser) {
    // User is logged in
    // Show the logout button
    logoutButton.style.display = 'block';

    // Add a click event listener to the logout button
    logoutButton.addEventListener('click', () => {
        // Clear the stored user data (log out the user)
        localStorage.removeItem('loggedInUser');
        sessionStorage.removeItem('loggedInUser');
        const styleSheetLink = document.getElementById('styleSheet');
        styleSheetLink.href = 'desktop_styles.css';

        // Redirect the user to the login page
        window.location.href = 'login.html';
    });
} else {
    // User is not logged in
    // Hide the logout button
    logoutButton.style.display = 'none';
    const styleSheetLink = document.getElementById('styleSheet');
    styleSheetLink.href = 'mobile_styles.css';
}

    </script>
</body>
</html>